# SocketBridge é¡¹ç›®è¯´æ˜Žæ–‡æ¡£

## ðŸ“‹ é¡¹ç›®æ¦‚è¿°

**SocketBridge** æ˜¯ä¸€ä¸ªä¸ºã€Šä»¥æ’’çš„ç»“åˆï¼šé‡ç”Ÿã€‹ï¼ˆThe Binding of Isaac: Repentanceï¼‰æ¸¸æˆå¼€å‘çš„æ¨¡ç»„ï¼Œå®žçŽ°äº†æ¸¸æˆä¸Ž Python ç¨‹åºä¹‹é—´çš„å®žæ—¶æ•°æ®æ¡¥æŽ¥ã€‚è¯¥é¡¹ç›®æ—¨åœ¨ä¸ºæ¸¸æˆ AI å¼€å‘ã€æ•°æ®åˆ†æžå’Œè‡ªåŠ¨åŒ–æµ‹è¯•æä¾›å¼ºå¤§çš„åŸºç¡€è®¾æ–½ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å®žæ—¶æ•°æ®é‡‡é›†** - é«˜æ•ˆé‡‡é›†æ¸¸æˆå†…å„ç±»æ•°æ®ï¼ˆçŽ©å®¶ã€æ•Œäººã€æŠ•å°„ç‰©ã€æˆ¿é—´ç­‰ï¼‰
- âœ… **å¤šé¢‘çŽ‡é‡‡é›†** - æ”¯æŒé«˜é¢‘/ä¸­é¢‘/ä½Žé¢‘/å˜åŒ–æ—¶å››ç§é‡‡é›†æ¨¡å¼
- âœ… **åŒå‘é€šä¿¡** - æ¸¸æˆæ•°æ®å®žæ—¶ä¼ è¾“åˆ° Pythonï¼ŒPython å¯å‘é€æŽ§åˆ¶æŒ‡ä»¤å›žæ¸¸æˆ
- âœ… **äº‹ä»¶ç³»ç»Ÿ** - å®Œæ•´çš„æ¸¸æˆäº‹ä»¶ç›‘å¬ä¸Žå›žè°ƒæœºåˆ¶
- âœ… **AI æŽ§åˆ¶æ”¯æŒ** - å†…ç½® AI æŽ§åˆ¶æ¡†æž¶ï¼Œæ”¯æŒæ‰‹åŠ¨/AI æ¨¡å¼åˆ‡æ¢ï¼ˆF3 é”®ï¼‰
- âœ… **æ•°æ®è®°å½•** - å†…ç½®æ•°æ®è®°å½•å™¨ï¼Œæ”¯æŒæ¸¸æˆä¼šè¯å½•åˆ¶ä¸Žå›žæ”¾
- âœ… **æ¨¡å—åŒ–è®¾è®¡** - å¯æ‰©å±•çš„æ”¶é›†å™¨æ³¨å†Œç³»ç»Ÿï¼Œæ˜“äºŽæ·»åŠ æ–°çš„æ•°æ®é€šé“

---

## ðŸ—ï¸ é¡¹ç›®æž¶æž„

### æ•´ä½“æž¶æž„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    The Binding of Isaac                      â”‚
â”‚                      (æ¸¸æˆè¿›ç¨‹)                               â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              main.lua (æ¸¸æˆæ¨¡ç»„)                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Collector    â”‚  â”‚   Network    â”‚  â”‚   Event    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Registry    â”‚  â”‚   Layer      â”‚  â”‚   System   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   Protocol    â”‚  â”‚   Input      â”‚  â”‚   Command  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    Layer      â”‚  â”‚  Executor    â”‚  â”‚  Handler   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â”‚ TCP Socket (127.0.0.1:9527)      â”‚
â”‚                          â–¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Python è¿›ç¨‹                               â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              isaac_bridge.py (æ ¸å¿ƒæ¡¥æŽ¥)               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   Network    â”‚  â”‚   GameState  â”‚  â”‚   Event    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Server     â”‚  â”‚   Manager    â”‚  â”‚   System   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                   â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚          â–¼               â–¼               â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ example_ai   â”‚ â”‚data_recorder â”‚ â”‚  è‡ªå®šä¹‰æ¨¡å—   â”‚        â”‚
â”‚  â”‚   (AIæŽ§åˆ¶)   â”‚ â”‚  (æ•°æ®è®°å½•)  â”‚ â”‚              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡ä»¶ç»“æž„

```
SocketBridge/
â”œâ”€â”€ main.lua                 # æ¸¸æˆæ¨¡ç»„ä¸»æ–‡ä»¶ï¼ˆLuaï¼‰
â”œâ”€â”€ metadata.xml             # æ¨¡ç»„å…ƒæ•°æ®
â””â”€â”€ python/                  # Python ç«¯ä»£ç 
    â”œâ”€â”€ isaac_bridge.py      # æ ¸å¿ƒæ¡¥æŽ¥åº“
    â”œâ”€â”€ data_recorder.py     # æ•°æ®è®°å½•å™¨
    â”œâ”€â”€ example_ai.py        # AI æŽ§åˆ¶ç¤ºä¾‹
    â”œâ”€â”€ logs/                # æ—¥å¿—ç›®å½•
    â””â”€â”€ recordings/          # å½•åˆ¶æ•°æ®ç›®å½•
```

---

## ðŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. Lua ç«¯ (main.lua)

#### 1.1 é…ç½®ç³»ç»Ÿ (Config)

```lua
Config = {
    HOST = "127.0.0.1",      -- æœåŠ¡å™¨åœ°å€
    PORT = 9527,             -- æœåŠ¡å™¨ç«¯å£
    
    -- é‡‡é›†é¢‘çŽ‡é…ç½®ï¼ˆå¸§æ•°é—´éš”ï¼‰
    CollectIntervals = {
        HIGH = 1,            -- æ¯å¸§é‡‡é›†
        MEDIUM = 5,          -- 5å¸§ä¸€æ¬¡
        LOW = 30,            -- 30å¸§ä¸€æ¬¡
        ON_CHANGE = -1       -- ä»…åœ¨å˜åŒ–æ—¶é‡‡é›†
    },
}
```

#### 1.2 æ”¶é›†å™¨æ³¨å†Œç³»ç»Ÿ (CollectorRegistry)

è¿™æ˜¯æ•´ä¸ªæ•°æ®é‡‡é›†çš„æ ¸å¿ƒï¼Œé‡‡ç”¨æ³¨å†Œè¡¨æ¨¡å¼ç®¡ç†æ‰€æœ‰æ•°æ®æ”¶é›†å™¨ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- åŠ¨æ€æ³¨å†Œæ•°æ®æ”¶é›†å™¨
- æ”¯æŒå¯ç”¨/ç¦ç”¨å•ä¸ªæ”¶é›†å™¨
- æ”¯æŒåŠ¨æ€è°ƒæ•´é‡‡é›†é¢‘çŽ‡
- è‡ªåŠ¨ç¼“å­˜å’Œå˜åŒ–æ£€æµ‹

**å·²æ³¨å†Œçš„æ•°æ®é€šé“ï¼š**

| é€šé“åç§° | é‡‡é›†é¢‘çŽ‡ | ä¼˜å…ˆçº§ | è¯´æ˜Ž |
|---------|---------|--------|------|
| PLAYER_POSITION | HIGH | 10 | çŽ©å®¶ä½ç½®ã€é€Ÿåº¦ã€æœå‘ |
| PLAYER_STATS | LOW | 5 | çŽ©å®¶å±žæ€§ï¼ˆä¼¤å®³ã€é€Ÿåº¦ã€å°„ç¨‹ç­‰ï¼‰ |
| PLAYER_HEALTH | ON_CHANGE | 8 | çŽ©å®¶ç”Ÿå‘½å€¼ |
| PLAYER_INVENTORY | ON_CHANGE | 3 | çŽ©å®¶ç‰©å“æ ã€é“å…·ã€æ¶ˆè€—å“ |
| ENEMIES | MEDIUM | 7 | æ•Œäººä¿¡æ¯ï¼ˆä½ç½®ã€è¡€é‡ã€çŠ¶æ€ï¼‰ |
| PROJECTILES | HIGH | 9 | æŠ•å°„ç‰©ï¼ˆæ•ŒäººæŠ•å°„ç‰©ã€çŽ©å®¶çœ¼æ³ªã€æ¿€å…‰ï¼‰ |
| ROOM_INFO | MEDIUM | 4 | æˆ¿é—´ä¿¡æ¯ï¼ˆç±»åž‹ã€æ¸…é™¤çŠ¶æ€ã€æ•Œäººæ•°é‡ï¼‰ |
| ROOM_LAYOUT | ON_CHANGE | 2 | æˆ¿é—´å¸ƒå±€ï¼ˆéšœç¢ç‰©ã€é—¨ï¼‰ |

#### 1.3 ç½‘ç»œå±‚ (Network)

è´Ÿè´£ä¸Ž Python ç«¯çš„ TCP é€šä¿¡ã€‚

**ä¸»è¦æ–¹æ³•ï¼š**
- `connect()` - è¿žæŽ¥åˆ° Python æœåŠ¡å™¨
- `disconnect()` - æ–­å¼€è¿žæŽ¥
- `send(data)` - å‘é€ JSON æ•°æ®
- `receive()` - æŽ¥æ”¶ JSON æ•°æ®

#### 1.4 åè®®å±‚ (Protocol)

å®šä¹‰æ¶ˆæ¯æ ¼å¼å’Œç±»åž‹ã€‚

**æ¶ˆæ¯ç±»åž‹ï¼š**
- `DATA` - å¢žé‡æ•°æ®æ›´æ–°
- `FULL_STATE` - å®Œæ•´çŠ¶æ€å¿«ç…§
- `EVENT` - æ¸¸æˆäº‹ä»¶
- `CMD` - å‘½ä»¤å“åº”

**æ¶ˆæ¯æ ¼å¼ç¤ºä¾‹ï¼š**
```json
{
  "version": "2.0",
  "type": "DATA",
  "timestamp": 1234567890,
  "frame": 1234,
  "room_index": 42,
  "payload": {
    "PLAYER_POSITION": {...},
    "ENEMIES": [...]
  },
  "channels": ["PLAYER_POSITION", "ENEMIES"]
}
```

#### 1.5 è¾“å…¥æ‰§è¡Œå™¨ (InputExecutor)

æŽ¥æ”¶æ¥è‡ª Python çš„æŽ§åˆ¶æŒ‡ä»¤å¹¶æ‰§è¡Œæ¸¸æˆè¾“å…¥ã€‚

**æ”¯æŒçš„è¾“å…¥ç±»åž‹ï¼š**
- ç§»åŠ¨æ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³ï¼‰
- å°„å‡»æ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³ï¼‰
- ä½¿ç”¨é“å…·
- æ”¾ç½®ç‚¸å¼¹
- ä½¿ç”¨å¡ç‰Œ/è¯ä¸¸
- ä¸¢å¼ƒç‰©å“

#### 1.6 äº‹ä»¶ç³»ç»Ÿ (EventSystem)

ç›‘å¬æ¸¸æˆå†…äº‹ä»¶å¹¶è½¬å‘åˆ° Pythonã€‚

**æ”¯æŒçš„äº‹ä»¶ï¼š**
- `GAME_START` - æ¸¸æˆå¼€å§‹
- `GAME_END` - æ¸¸æˆç»“æŸ
- `ROOM_CLEAR` - æˆ¿é—´æ¸…é™¤
- `PLAYER_DAMAGE` - çŽ©å®¶å—ä¼¤
- `NPC_DEATH` - NPC æ­»äº¡
- `PLAYER_DEATH` - çŽ©å®¶æ­»äº¡
- `ITEM_COLLECTED` - èŽ·å¾—é“å…·

#### 1.7 æ‰‹åŠ¨/AI æ¨¡å¼åˆ‡æ¢

- æŒ‰ **F3** é”®åˆ‡æ¢æ‰‹åŠ¨/AI æŽ§åˆ¶æ¨¡å¼
- AI æ¨¡å¼ä¸‹ï¼Œå½“æˆ¿é—´å†…æœ‰æ•Œäººæ—¶è‡ªåŠ¨å¯ç”¨ AI æŽ§åˆ¶
- æ‰‹åŠ¨æ¨¡å¼ä¸‹ï¼Œå®Œå…¨ç”±çŽ©å®¶æŽ§åˆ¶

---

### 2. Python ç«¯ (isaac_bridge.py)

#### 2.1 IsaacBridge ç±»

æ ¸å¿ƒæ¡¥æŽ¥ç±»ï¼Œè´Ÿè´£ä¸Žæ¸¸æˆé€šä¿¡ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- TCP æœåŠ¡å™¨ï¼ˆç›‘å¬ 127.0.0.1:9527ï¼‰
- ç»´æŠ¤å®žæ—¶æ¸¸æˆçŠ¶æ€
- äº‹ä»¶å›žè°ƒç³»ç»Ÿ
- å‘é€æŽ§åˆ¶æŒ‡ä»¤

**æ ¸å¿ƒæ–¹æ³•ï¼š**

```python
# å¯åŠ¨/åœæ­¢æœåŠ¡å™¨
bridge.start()
bridge.stop()

# æ³¨å†Œäº‹ä»¶å›žè°ƒ
@bridge.on("event:PLAYER_DAMAGE")
def on_player_damage(data):
    print(f"Player took {data['amount']} damage")

# å‘é€æŽ§åˆ¶æŒ‡ä»¤
bridge.send_input(move_dir=(1, 0), shoot_dir=(0, -1))
bridge.use_item()
bridge.use_bomb()
```

#### 2.2 GameState ç±»

æ¸¸æˆçŠ¶æ€å®¹å™¨ï¼Œæ”¯æŒå¢žé‡æ›´æ–°ã€‚

```python
@dataclass
class GameState:
    data: Dict[str, Any]           # å„é€šé“æ•°æ®
    last_update: Dict[str, int]    # æœ€åŽæ›´æ–°å¸§
    frame: int                     # å½“å‰å¸§
    room_index: int                # å½“å‰æˆ¿é—´ç´¢å¼•
```

#### 2.3 GameDataAccessor ç±»

æä¾›ä¾¿æ·çš„æ¸¸æˆæ•°æ®è®¿é—®æŽ¥å£ã€‚

```python
data = GameDataAccessor(bridge)

# èŽ·å–çŽ©å®¶ä½ç½®
player_pos = data.get_player_position()

# èŽ·å–æ•Œäººåˆ—è¡¨
enemies = data.get_enemies()

# èŽ·å–æŠ•å°„ç‰©
projectiles = data.get_enemy_projectiles()

# èŽ·å–æˆ¿é—´ä¿¡æ¯
room_info = data.get_room_info()
```

#### 2.4 äº‹ä»¶ç³»ç»Ÿ

æ”¯æŒå¤šç§äº‹ä»¶è®¢é˜…æ–¹å¼ï¼š

```python
# è®¢é˜…ç‰¹å®šäº‹ä»¶
@bridge.on("event:GAME_START")
def on_game_start(data):
    print("Game started!")

# è®¢é˜…æ•°æ®é€šé“æ›´æ–°
@bridge.on("data:PLAYER_HEALTH")
def on_health_update(health):
    print(f"Health: {health}")

# è®¢é˜…æ‰€æœ‰æ•°æ®æ›´æ–°
@bridge.on("data")
def on_data_update(data):
    print(f"Received data: {data}")
```

---

### 3. æ•°æ®è®°å½•å™¨ (data_recorder.py)

ç”¨äºŽè®°å½•æ¸¸æˆæ•°æ®ä»¥ä¾›åŽç»­åˆ†æžæˆ–è®­ç»ƒä½¿ç”¨ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- è‡ªåŠ¨è®°å½•æ¸¸æˆä¼šè¯
- å¸§çº§æ•°æ®è®°å½•
- äº‹ä»¶è®°å½•
- è‡ªåŠ¨ä¿å­˜ï¼ˆæ”¯æŒ gzip åŽ‹ç¼©ï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
from isaac_bridge import IsaacBridge
from data_recorder import GameDataRecorder

bridge = IsaacBridge()
recorder = GameDataRecorder(bridge, output_dir="./recordings")

bridge.start()
# æ¸¸æˆæ•°æ®ä¼šè‡ªåŠ¨è®°å½•
```

**è®°å½•çš„æ•°æ®æ ¼å¼ï¼š**

```json
{
  "session_id": "session_20240106_123456",
  "start_time": 1704537296.0,
  "continued": false,
  "metadata": {},
  "frames": [
    {
      "frame": 1234,
      "timestamp": 1704537296.123,
      "data": {
        "PLAYER_POSITION": {...},
        "ENEMIES": [...]
      }
    }
  ],
  "events": [
    {
      "type": "PLAYER_DAMAGE",
      "frame": 1250,
      "timestamp": 1704537296.456,
      "data": {...}
    }
  ]
}
```

---

### 4. AI æŽ§åˆ¶ç¤ºä¾‹ (example_ai.py)

æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ IsaacBridge å®žçŽ°ç®€å•çš„ AI æŽ§åˆ¶é€»è¾‘ã€‚

**SimpleAI ç±»ï¼š**

```python
class SimpleAI:
    def __init__(self, bridge: IsaacBridge):
        self.bridge = bridge
        self.data = GameDataAccessor(bridge)
        self.action_interval = 3  # æ¯3å¸§å†³ç­–ä¸€æ¬¡
    
    def update(self):
        """æ¯å¸§æ›´æ–°ï¼Œè¿”å›ž (ç§»åŠ¨æ–¹å‘, å°„å‡»æ–¹å‘)"""
        # èŽ·å–çŽ©å®¶ä½ç½®
        player_pos = self.data.get_player_position()
        
        # èŽ·å–æ•Œäººå’ŒæŠ•å°„ç‰©
        enemies = self.data.get_enemies()
        projectiles = self.data.get_enemy_projectiles()
        
        # å†³ç­–
        move_dir = self._decide_movement(...)
        shoot_dir = self._decide_shooting(...)
        
        return move_dir, shoot_dir
```

**AI ç­–ç•¥ï¼š**
- **ç§»åŠ¨å†³ç­–** - è¿œç¦»æœ€è¿‘çš„å±é™©ï¼ˆæŠ•å°„ç‰©å’Œæ•Œäººï¼‰
- **å°„å‡»å†³ç­–** - å‘æœ€è¿‘çš„æ•Œäººå°„å‡»

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### çŽ¯å¢ƒè¦æ±‚

- ã€Šä»¥æ’’çš„ç»“åˆï¼šé‡ç”Ÿã€‹æ¸¸æˆ
- Python 3.8+
- Python ä¾èµ–ï¼šæ— ï¼ˆä»…ä½¿ç”¨æ ‡å‡†åº“ï¼‰

### å®‰è£…æ­¥éª¤

1. **å®‰è£…æ¸¸æˆæ¨¡ç»„**
   - å°† `SocketBridge` æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¸¸æˆ mods ç›®å½•
   - åœ¨æ¸¸æˆä¸­å¯ç”¨ SocketBridge æ¨¡ç»„

2. **å¯åŠ¨ Python ç«¯**
   ```bash
   cd python
   python isaac_bridge.py
   ```

3. **å¯åŠ¨æ¸¸æˆ**
   - å¯åŠ¨ã€Šä»¥æ’’çš„ç»“åˆï¼šé‡ç”Ÿã€‹
   - æ¨¡ç»„ä¼šè‡ªåŠ¨è¿žæŽ¥åˆ° Python æœåŠ¡å™¨

### åŸºæœ¬ä½¿ç”¨

#### 1. æŽ¥æ”¶æ¸¸æˆæ•°æ®

```python
from isaac_bridge import IsaacBridge

bridge = IsaacBridge()

@bridge.on("data")
def on_data(data):
    print(f"Frame {bridge.state.frame}: {data}")

bridge.start()
```

#### 2. æŽ§åˆ¶ AI

```python
from isaac_bridge import IsaacBridge, GameDataAccessor
import time

bridge = IsaacBridge()
data = GameDataAccessor(bridge)

@bridge.on("data")
def on_update(data):
    # èŽ·å–çŽ©å®¶ä½ç½®
    player = data.get_player_position()
    
    # èŽ·å–æœ€è¿‘çš„æ•Œäºº
    enemies = data.get_enemies()
    if enemies:
        nearest = min(enemies, key=lambda e: e['distance'])
        
        # å‘æ•Œäººç§»åŠ¨å¹¶å°„å‡»
        dx = nearest['pos']['x'] - player['pos']['x']
        dy = nearest['pos']['y'] - player['pos']['y']
        
        move_dir = (1 if dx > 0 else -1 if dx < 0 else 0,
                    1 if dy > 0 else -1 if dy < 0 else 0)
        shoot_dir = move_dir
        
        bridge.send_input(move_dir=move_dir, shoot_dir=shoot_dir)

bridge.start()
```

#### 3. è®°å½•æ¸¸æˆæ•°æ®

```python
from isaac_bridge import IsaacBridge
from data_recorder import GameDataRecorder

bridge = IsaacBridge()
recorder = GameDataRecorder(bridge)

bridge.start()
# æ¸¸æˆæ•°æ®ä¼šè‡ªåŠ¨è®°å½•åˆ° recordings/ ç›®å½•
```

---

## ðŸ“Š æ•°æ®é€šé“è¯¦ç»†è¯´æ˜Ž

### PLAYER_POSITION

**é‡‡é›†é¢‘çŽ‡ï¼š** HIGHï¼ˆæ¯å¸§ï¼‰

**æ•°æ®ç»“æž„ï¼š**
```json
{
  "0": {
    "pos": {"x": 100.0, "y": 200.0},
    "vel": {"x": 1.5, "y": 0.0},
    "move_dir": 1,
    "fire_dir": 2,
    "head_dir": 1,
    "aim_dir": {"x": 0.8, "y": 0.6}
  }
}
```

### PLAYER_STATS

**é‡‡é›†é¢‘çŽ‡ï¼š** LOWï¼ˆ30å¸§ï¼‰

**æ•°æ®ç»“æž„ï¼š**
```json
{
  "0": {
    "player_type": 0,
    "damage": 3.5,
    "speed": 1.0,
    "tears": 15,
    "range": 220.0,
    "tear_range": 5.5,
    "shot_speed": 1.0,
    "luck": 1.0,
    "tear_height": -6.0,
    "tear_falling_speed": 1.5,
    "can_fly": false,
    "size": 10.0,
    "sprite_scale": 1.0
  }
}
```

### PLAYER_HEALTH

**é‡‡é›†é¢‘çŽ‡ï¼š** LOWï¼ˆ30å¸§ï¼‰

**æ•°æ®ç»“æž„ï¼š**
```json
{
  "0": {
    "red_hearts": 6,
    "max_hearts": 6,
    "soul_hearts": 2,
    "black_hearts": 0,
    "bone_hearts": 0,
    "golden_hearts": 0,
    "eternal_hearts": 0,
    "rotten_hearts": 0,
    "broken_hearts": 0,
    "extra_lives": 0
  }
}
```

### ENEMIES

**é‡‡é›†é¢‘çŽ‡ï¼š** HIGHï¼ˆæ¯å¸§ï¼‰

**æ•°æ®ç»“æž„ï¼š**
```json
[
  {
    "id": 12345,
    "type": 10,
    "variant": 0,
    "subtype": 0,
    "pos": {"x": 300.0, "y": 200.0},
    "vel": {"x": 0.5, "y": 0.0},
    "hp": 20.0,
    "max_hp": 20.0,
    "is_boss": false,
    "is_champion": false,
    "state": 3,
    "state_frame": 10,
    "projectile_cooldown": 30,
    "projectile_delay": 60,
    "collision_radius": 15.0,
    "distance": 250.0,
    "target_pos": {"x": 100.0, "y": 200.0},
    "v1": {"x": 0.0, "y": 0.0},
    "v2": {"x": 0.0, "y": 0.0}
  }
]
```

### PROJECTILES

**é‡‡é›†é¢‘çŽ‡ï¼š** HIGHï¼ˆæ¯å¸§ï¼‰

**æ•°æ®ç»“æž„ï¼š**
```json
{
  "enemy_projectiles": [
    {
      "id": 67890,
      "pos": {"x": 250.0, "y": 180.0},
      "vel": {"x": -2.0, "y": 0.0},
      "variant": 0,
      "collision_radius": 8.0,
      "height": 0.0,
      "falling_speed": 0.0,
      "falling_accel": 0.0
    }
  ],
  "player_tears": [
    {
      "id": 11111,
      "pos": {"x": 120.0, "y": 200.0},
      "vel": {"x": 3.0, "y": 0.0},
      "variant": 0,
      "collision_radius": 6.0,
      "height": 0.0,
      "scale": 1.0
    }
  ],
  "lasers": [
    {
      "id": 22222,
      "pos": {"x": 300.0, "y": 200.0},
      "angle": 0.0,
      "max_distance": 400.0,
      "is_enemy": true
    }
  ]
}
```

### ROOM_INFO

**é‡‡é›†é¢‘çŽ‡ï¼š** LOW

**æ•°æ®ç»“æž„ï¼š**
```json
{
  "room_type": 1,
  "room_shape": 1,
  "room_idx": 42,
  "stage": 1,
  "stage_type": 0,
  "difficulty": 0,
  "is_clear": false,
  "is_first_visit": true,
  "grid_width": 13,
  "grid_height": 7,
  "top_left": {"x": 280.0, "y": 140.0},
  "bottom_right": {"x": 560.0, "y": 420.0},
  "has_boss": false,
  "enemy_count": 5,
  "room_variant": 0
}
```

### ROOM_LAYOUT

**é‡‡é›†é¢‘çŽ‡ï¼š** LOW

**æ•°æ®ç»“æž„ï¼š**
```json
{
  "grid": {
    "42": {
      "type": 2,
      "variant": 0,
      "state": 0,
      "collision": 1,
      "x": 280.0,
      "y": 140.0
    }
  },
  "doors": {
    "0": {
      "target_room": 41,
      "target_door_slot": 2,
      "state": 0,
      "variant": 0
    }
  }
}
```

---

## ðŸŽ® æŽ§åˆ¶æŒ‡ä»¤

### å‘é€è¾“å…¥æŒ‡ä»¤

```python
# ç§»åŠ¨å’Œå°„å‡»
bridge.send_input(
    move_dir=(x, y),    # x, y âˆˆ {-1, 0, 1}
    shoot_dir=(x, y)     # x, y âˆˆ {-1, 0, 1}
)

# ä½¿ç”¨ä¸»åŠ¨é“å…·
bridge.use_item()

# æ”¾ç½®ç‚¸å¼¹
bridge.use_bomb()

# ä½¿ç”¨å¡ç‰Œ/è¯ä¸¸
bridge.use_card()
bridge.use_pill()

# ä¸¢å¼ƒç‰©å“
bridge.drop()
```

### æŽ§åˆ¶æŒ‡ä»¤æ ¼å¼

```json
{
  "version": "2.0",
  "type": "CMD",
  "timestamp": 1234567890,
  "input": {
    "move_dir": {"x": 1, "y": 0},
    "shoot_dir": {"x": 0, "y": -1},
    "use_item": false,
    "use_bomb": false,
    "use_card": false,
    "use_pill": false,
    "drop": false
  }
}
```

---

## ðŸ”Œ äº‹ä»¶ç³»ç»Ÿ

### æ¸¸æˆäº‹ä»¶

| äº‹ä»¶åç§° | è§¦å‘æ—¶æœº | æ•°æ®ç»“æž„ |
|---------|---------|---------|
| GAME_START | æ¸¸æˆå¼€å§‹ | `{"continued": bool}` |
| GAME_END | æ¸¸æˆç»“æŸ | `{"reason": str}` |
| ROOM_CLEAR | æˆ¿é—´æ¸…é™¤ | `{"room_index": int}` |
| PLAYER_DAMAGE | çŽ©å®¶å—ä¼¤ | `{"amount": float, "flags": int, "source_type": int, "hp_after": int}` |
| NPC_DEATH | NPC æ­»äº¡ | `{"type": int, "variant": int, "subtype": int, "pos": dict, "is_boss": bool}` |
| PLAYER_DEATH | çŽ©å®¶æ­»äº¡ | `{"player_idx": int}` |
| ITEM_COLLECTED | èŽ·å¾—é“å…· | `{"item_id": int, "first_time": bool, "slot": int, "player_idx": int}` |

### äº‹ä»¶è®¢é˜…ç¤ºä¾‹

```python
@bridge.on("event:PLAYER_DAMAGE")
def on_damage(data):
    print(f"Player took {data['amount']} damage!")

@bridge.on("event:NPC_DEATH")
def on_npc_death(data):
    if data['is_boss']:
        print("Boss defeated!")
```

---

## ðŸ› ï¸ é«˜çº§åŠŸèƒ½

### 1. åŠ¨æ€é…ç½®æ•°æ®é€šé“

```python
# ç¦ç”¨æŸä¸ªæ•°æ®é€šé“
bridge.set_channel_enabled("PLAYER_STATS", False)

# è°ƒæ•´é‡‡é›†é¢‘çŽ‡
bridge.set_channel_interval("ENEMIES", "HIGH")

# èŽ·å–å½“å‰é…ç½®
config = bridge.get_channel_config()
```

### 2. è‡ªå®šä¹‰æ•°æ®æ”¶é›†å™¨ï¼ˆLua ç«¯ï¼‰

```lua
-- åœ¨ main.lua ä¸­æ·»åŠ è‡ªå®šä¹‰æ”¶é›†å™¨
CollectorRegistry:register("CUSTOM_DATA", {
    interval = "MEDIUM",
    priority = 6,
    collect = function()
        -- è‡ªå®šä¹‰é‡‡é›†é€»è¾‘
        return {
            custom_field = Game():GetFrameCount()
        }
    end
})
```

### 3. æ‰¹é‡æ•°æ®æŸ¥è¯¢

```python
# èŽ·å–å®Œæ•´çŠ¶æ€
full_state = bridge.state.get_full_state()

# èŽ·å–å¤šä¸ªé€šé“æ•°æ®
data = {
    "player": bridge.state.get("PLAYER_POSITION"),
    "enemies": bridge.state.get("ENEMIES"),
    "room": bridge.state.get("ROOM_INFO")
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

```python
# åªè®¢é˜…éœ€è¦çš„æ•°æ®é€šé“
@bridge.on("data:PLAYER_POSITION")
def on_position(pos):
    # åªå¤„ç†çŽ©å®¶ä½ç½®æ›´æ–°
    pass

# ä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—å¼‚æ­¥å¤„ç†
while True:
    event = bridge.event_queue.get()
    if event.type == "PLAYER_DAMAGE":
        # å¤„ç†ä¼¤å®³äº‹ä»¶
        pass
```

---

## ðŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ•°æ®é‡‡é›†æ€§èƒ½

| æ•°æ®é€šé“ | é‡‡é›†é¢‘çŽ‡ | æ•°æ®é‡ | CPU å ç”¨ |
|---------|---------|--------|---------|
| PLAYER_POSITION | 60 fps | ~200 B | < 1% |
| ENEMIES | 12 fps | ~2 KB | < 2% |
| PROJECTILES | 60 fps | ~1 KB | < 1% |
| ROOM_INFO | 12 fps | ~300 B | < 1% |

### ç½‘ç»œæ€§èƒ½

- **åè®®ï¼š** TCP
- **ç«¯å£ï¼š** 9527
- **å»¶è¿Ÿï¼š** < 5msï¼ˆæœ¬åœ°ï¼‰
- **åžåé‡ï¼š** ~500 KB/sï¼ˆå…¨é€šé“å¼€å¯ï¼‰

---

## ðŸ› æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿žæŽ¥å¤±è´¥**
   - ç¡®è®¤ Python æœåŠ¡å™¨å·²å¯åŠ¨
   - æ£€æŸ¥ç«¯å£ 9527 æ˜¯å¦è¢«å ç”¨
   - æŸ¥çœ‹æ¸¸æˆæŽ§åˆ¶å°æ—¥å¿—

2. **æ•°æ®ä¸æ›´æ–°**
   - æ£€æŸ¥æ•°æ®é€šé“æ˜¯å¦å¯ç”¨
   - ç¡®è®¤é‡‡é›†é¢‘çŽ‡è®¾ç½®
   - æŸ¥çœ‹äº‹ä»¶å›žè°ƒæ˜¯å¦æ­£ç¡®æ³¨å†Œ

3. **AI æŽ§åˆ¶ä¸ç”Ÿæ•ˆ**
   - ç¡®è®¤ AI æ¨¡å¼å·²å¯ç”¨ï¼ˆæŒ‰ F3 åˆ‡æ¢ï¼‰
   - æ£€æŸ¥æŽ§åˆ¶æŒ‡ä»¤æ˜¯å¦æ­£ç¡®å‘é€
   - ç¡®è®¤æˆ¿é—´å†…æœ‰æ•Œäººï¼ˆAI ä»…åœ¨æˆ˜æ–—æ—¶æ¿€æ´»ï¼‰

### è°ƒè¯•æŠ€å·§

```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
print(bridge.stats)

# æŸ¥çœ‹å½“å‰çŠ¶æ€
print(bridge.state.get_full_state())
```

---

## ðŸ“ å¼€å‘è·¯çº¿å›¾

### å·²å®Œæˆ âœ…

- âœ… åŸºç¡€æ•°æ®é‡‡é›†æ¡†æž¶
- âœ… ç½‘ç»œé€šä¿¡å±‚
- âœ… äº‹ä»¶ç³»ç»Ÿ
- [x] AI æŽ§åˆ¶æ”¯æŒ
- [x] æ•°æ®è®°å½•å™¨
- âœ… æ‰‹åŠ¨/AI æ¨¡å¼åˆ‡æ¢

### è®¡åˆ’ä¸­ ðŸš§

- [ ] æ›´å¤šæ•°æ®é€šé“ï¼ˆé“å…·æ•ˆæžœã€è¯…å’’ç­‰ï¼‰
- [ ] å¯è§†åŒ–è°ƒè¯•å·¥å…·
- [ ] å¼ºåŒ–å­¦ä¹ é›†æˆ
- [ ] å¤šçŽ©å®¶æ”¯æŒ
- [ ] æ€§èƒ½ä¼˜åŒ–

---

## ðŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

---

## ðŸ¤ è´¡çŒ®

æ¬¢è¿Žæäº¤ Issue å’Œ Pull Requestï¼

---

## ðŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ GitHub Issues è”ç³»ã€‚

---

**æœ€åŽæ›´æ–°ï¼š** 2026å¹´1æœˆ6æ—¥
**ç‰ˆæœ¬ï¼š** 2.0
