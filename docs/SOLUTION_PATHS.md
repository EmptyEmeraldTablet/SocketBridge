# SocketBridge æ•°æ®é‡‡é›†æ ¼å¼ç»Ÿä¸€ - è§£å†³æ–¹æ¡ˆè·¯çº¿æ–‡æ¡£

> åˆ›å»ºæ—¶é—´: 2026-01-11
> 
> èƒŒæ™¯: å½“å‰å­˜åœ¨ä¸¤å¥—æ•°æ®é‡‡é›†ç³»ç»Ÿ (`data_replay_system.py` å’Œ `data_recorder.py`)ï¼Œå®ƒä»¬ä½¿ç”¨ä¸åŒçš„æ•°æ®æ ¼å¼ã€‚è¿™å¯¼è‡´ä»£ç å†—ä½™ã€ç»´æŠ¤å›°éš¾ï¼Œä¸” `test_integration.py` æ— æ³•æ­£å¸¸å·¥ä½œã€‚
>
> ç»è¿‡åˆ†æï¼Œç¡®å®šä¸¤æ¡å¯èƒ½çš„è§£å†³è·¯çº¿ï¼š
> - **è·¯çº¿ 1**: ä¿®æ”¹ main.lua å’Œ isaac_bridge.pyï¼Œç»Ÿä¸€æ¶ˆæ¯æ ¼å¼
> - **è·¯çº¿ 2**: ä¿æŒç°æœ‰æ ¼å¼ï¼Œå¯»æ‰¾å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ

---

## ğŸ“‹ è·¯çº¿ 1: ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼

> **æ ¸å¿ƒç†å¿µ**: ä¿®æ”¹åº•å±‚åè®®ï¼Œä½¿ isaac_bridge.py çš„ "data" å›è°ƒä¼ é€’å®Œæ•´æ¶ˆæ¯è€Œéä»… payload
> 
> **ä¼˜ç‚¹**: 
> - æ¶æ„æ›´æ¸…æ™°ï¼Œä»£ç æ›´ç®€æ´
> - å½•åˆ¶ç³»ç»Ÿä¸å›æ”¾ç³»ç»Ÿæ ¼å¼ä¸€è‡´
> - æœªæ¥æ‰©å±•æ›´å®¹æ˜“
>
> **ç¼ºç‚¹**:
> - éœ€è¦ä¿®æ”¹ main.luaï¼ˆLua ä»£ç ï¼‰
> - éœ€è¦ä¿®æ”¹ isaac_bridge.py
> - **éœ€è¦å¤§é‡å®æœºæµ‹è¯•**ï¼ˆæ¸¸æˆå†…æµ‹è¯•è€—æ—¶ï¼‰
> - é£é™©è¾ƒé«˜ï¼Œå¯èƒ½å¼•å…¥æ–°é—®é¢˜

### TODO List

#### Phase 1: åè®®è®¾è®¡ä¸ä¿®æ”¹ (é¢„ä¼° 1-2 å‘¨)

- [ ] 1.1 åˆ†æ main.lua ä¸­çš„ Network å±‚ä»£ç 
  - [ ] å®šä½ `Network.send()` å‡½æ•°
  - [ ] ç†è§£å½“å‰æ¶ˆæ¯æ ¼å¼
  - [ ] è®°å½•æ‰€æœ‰æ¶ˆæ¯ç±»å‹ (DATA, EVENT, FULL_STATE, COMMAND)
  
- [ ] 1.2 è®¾è®¡æ–°çš„å›è°ƒæ¶ˆæ¯æ ¼å¼
  - [ ] å†³å®š isaac_bridge.py çš„ "data" å›è°ƒä¼ é€’ä»€ä¹ˆå†…å®¹
  - [ ] è®¾è®¡å‘åå…¼å®¹æ€§æ–¹æ¡ˆ
  - [ ] ç¼–å†™åè®®è®¾è®¡æ–‡æ¡£
  
- [ ] 1.3 ä¿®æ”¹ isaac_bridge.py
  - [ ] ä¿®æ”¹ `_process_message()` æ–¹æ³•
  - [ ] ä¿®æ”¹ `on("data")` å›è°ƒçš„è§¦å‘æ–¹å¼
  - [ ] æ›´æ–° `GameState.update_batch()` æ–¹æ³•
  - [ ] ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆå¦‚æœå¯èƒ½ï¼‰
  
- [ ] 1.4 ä¿®æ”¹ main.lua (Lua)
  - [ ] ä¿®æ”¹ Network å±‚æ¶ˆæ¯å‘é€é€»è¾‘
  - [ ] è€ƒè™‘æ˜¯å¦éœ€è¦åœ¨ Lua ç«¯ä¹Ÿåšç›¸åº”ä¿®æ”¹
  - [ ] æµ‹è¯• Lua ä»£ç è¯­æ³•æ­£ç¡®æ€§

#### Phase 2: å½•åˆ¶ç³»ç»Ÿè¿ç§» (é¢„ä¼° 1 å‘¨)

- [ ] 2.1 ç»Ÿä¸€ data_replay_system.py å’Œ data_recorder.py
  - [ ] é€‰æ‹©ä¸€ä¸ªä½œä¸ºä¸»å®ç°
  - [ ] é‡æ„å¦ä¸€ä¸ªä»¥ä½¿ç”¨ç›¸åŒæ ¼å¼
  - [ ] åˆ é™¤é‡å¤ä»£ç 
  
- [ ] 2.2 æ›´æ–° data_replay_examples.py
  - [ ] æ›´æ–°å½•åˆ¶ç¤ºä¾‹ä»£ç 
  - [ ] æ›´æ–°å›æ”¾ç¤ºä¾‹ä»£ç 
  
- [ ] 2.3 æ›´æ–°æµ‹è¯•è„šæœ¬
  - [ ] ä¿®å¤ test_integration.py
  - [ ] æ›´æ–° test_replay_final.py
  - [ ] ç¼–å†™æ–°çš„é›†æˆæµ‹è¯•

#### Phase 3: å®æœºæµ‹è¯• (é¢„ä¼° 2-4 å‘¨)

> âš ï¸ è¿™ä¸€é˜¶æ®µéœ€è¦å¤§é‡æ¸¸æˆå†…æµ‹è¯•ï¼Œæ¯æ¬¡æµ‹è¯•éœ€è¦ï¼š
> - å¯åŠ¨æ¸¸æˆ
> - åŠ è½½ä¿®æ”¹åçš„æ¨¡ç»„
> - æ‰§è¡Œæµ‹è¯•åœºæ™¯
> - éªŒè¯æ•°æ®å®Œæ•´æ€§
> - æ’æŸ¥é—®é¢˜

- [ ] 3.1 åŸºç¡€è¿æ¥æµ‹è¯•
  - [ ] éªŒè¯ isaac_bridge.py èƒ½æ­£å¸¸å¯åŠ¨
  - [ ] éªŒè¯æ¸¸æˆèƒ½è¿æ¥
  - [ ] éªŒè¯åŸºæœ¬æ•°æ®æ¥æ”¶
  
- [ ] 3.2 æ•°æ®å®Œæ•´æ€§æµ‹è¯•
  - [ ] å½•åˆ¶å¹¶å›æ”¾ä¸€ä¸ªå®Œæ•´æ¸¸æˆä¼šè¯
  - [ ] éªŒè¯æ‰€æœ‰æ•°æ®é€šé“éƒ½æœ‰æ•°æ®
  - [ ] éªŒè¯ payload å’Œ channels ä¸ä¸º None
  
- [ ] 3.3 å›æ”¾åŠŸèƒ½æµ‹è¯•
  - [ ] éªŒè¯å›æ”¾é€Ÿåº¦æ§åˆ¶
  - [ ] éªŒè¯æš‚åœ/æ¢å¤åŠŸèƒ½
  - [ ] éªŒè¯è·³å¸§åŠŸèƒ½
  
- [ ] 3.4 è¾¹ç•Œæƒ…å†µæµ‹è¯•
  - [ ] å¤§é‡æ•Œäººåœºæ™¯
  - [ ] å¤šä¸ªæˆ¿é—´åˆ‡æ¢
  - [ ] é•¿æ—¶é—´æ¸¸æˆï¼ˆ30åˆ†é’Ÿ+ï¼‰
  - [ ] æ¸¸æˆå´©æºƒæ¢å¤

#### Phase 4: æ–‡æ¡£ä¸å‘å¸ƒ (é¢„ä¼° 1 å‘¨)

- [ ] 4.1 æ›´æ–°æ–‡æ¡£
  - [ ] æ›´æ–° DATA_PROTOCOL.md
  - [ ] æ›´æ–° README.md
  - [ ] ç¼–å†™è¿ç§»æŒ‡å—
  
- [ ] 4.2 ä»£ç å®¡æŸ¥
  - [ ] é‚€è¯·ä»£ç å®¡æŸ¥
  - [ ] å¤„ç†åé¦ˆ
  
- [ ] 4.3 å‘å¸ƒ
  - [ ] åˆå¹¶åˆ°ä¸»åˆ†æ”¯
  - [ ] åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
  - [ ] æ›´æ–° CHANGELOG.md

---

## ğŸ“‹ è·¯çº¿ 2: ä¿æŒæ ¼å¼å…¼å®¹

> **æ ¸å¿ƒç†å¿µ**: ä¸ä¿®æ”¹åº•å±‚åè®®ï¼Œé€šè¿‡é€‚é…å±‚å®ç°å…¼å®¹æ€§
> 
> **ä¼˜ç‚¹**:
> - æ— éœ€ä¿®æ”¹ main.luaï¼ˆé›¶é£é™©ï¼‰
> - å‡å°‘å®æœºæµ‹è¯•éœ€æ±‚
> - å¯ä»¥å¿«é€Ÿå¼€å§‹å·¥ä½œ
>
> **ç¼ºç‚¹**:
> - ä»£ç å¯èƒ½æ›´åŠ å¤æ‚
> - æŠ€æœ¯å€ºåŠ¡å¯èƒ½å¢åŠ 
> - é•¿æœŸç»´æŠ¤æˆæœ¬å¯èƒ½æ›´é«˜

### TODO List

#### Phase 1: é—®é¢˜è¯Šæ–­ä¸å¿«é€Ÿä¿®å¤ (é¢„ä¼° 1-3 å¤©)

- [ ] 1.1 ä¿®å¤ test_integration.py
  - [ ] æ·»åŠ ç¼ºå¤±çš„ `bridge.start()` è°ƒç”¨
  - [ ] ä¿®å¤ç«¯å£å ç”¨å¤„ç†
  - [ ] éªŒè¯æµ‹è¯•èƒ½è¿è¡Œ
  
- [ ] 1.2 åˆ†ææ ¼å¼å·®å¼‚
  - [ ] è¯¦ç»†å¯¹æ¯”ä¸¤ç§å½•åˆ¶æ ¼å¼
  - [ ] ç¡®å®šå…¼å®¹æ€§å±‚éœ€è¦åšä»€ä¹ˆè½¬æ¢

#### Phase 2: å…¼å®¹æ€§å±‚å®ç° (é¢„ä¼° 1 å‘¨)

- [ ] 2.1 åˆ›å»ºç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
  - [ ] è®¾è®¡ `UnifiedDataAccessor` ç±»
  - [ ] å°è£…ä¸¤ç§æ ¼å¼çš„å·®å¼‚
  - [ ] æä¾›ç»Ÿä¸€çš„ API
  
- [ ] 2.2 å®ç°æ ¼å¼è½¬æ¢å™¨
  - [ ] åˆ›å»º `PayloadToRawMessageConverter`
  - [ ] åˆ›å»º `RawMessageToPayloadConverter`
  - [ ] æµ‹è¯•è½¬æ¢æ­£ç¡®æ€§
  
- [ ] 2.3 ä¿®æ”¹å½•åˆ¶ä»£ç 
  - [ ] åœ¨ data_recorder.py ä¸­é›†æˆæ ¼å¼è½¬æ¢å™¨
  - [ ] ä¿æŒç°æœ‰ API ä¸å˜ï¼ˆå‘åå…¼å®¹ï¼‰
  - [ ] æ·»åŠ æ–‡æ¡£è¯´æ˜

#### Phase 3: æµ‹è¯•ä¸éªŒè¯ (é¢„ä¼° 1 å‘¨)

- [ ] 3.1 å•å…ƒæµ‹è¯•
  - [ ] æµ‹è¯•æ ¼å¼è½¬æ¢å™¨
  - [ ] æµ‹è¯•ç»Ÿä¸€è®¿é—®æ¥å£
  
- [ ] 3.2 é›†æˆæµ‹è¯•
  - [ ] éªŒè¯å½•åˆ¶åŠŸèƒ½æ­£å¸¸
  - [ ] éªŒè¯å›æ”¾åŠŸèƒ½æ­£å¸¸
  - [ ] éªŒè¯ä¸¤ç§æ ¼å¼èƒ½äº’æ“ä½œ
  
- [ ] 3.3 æ€§èƒ½æµ‹è¯•
  - [ ] æµ‹è¯•æ ¼å¼è½¬æ¢çš„æ€§èƒ½å¼€é”€
  - [ ] ä¼˜åŒ–çƒ­ç‚¹è·¯å¾„

#### Phase 4: é•¿æœŸæ”¹è¿›è§„åˆ’ (æŒç»­)

- [ ] 4.1 ç›‘æ§æŠ€æœ¯å€ºåŠ¡
  - [ ] è®°å½•æ‰€æœ‰ä¸´æ—¶è§£å†³æ–¹æ¡ˆ
  - [ ] å®šæœŸè¯„ä¼°æ˜¯å¦éœ€è¦é‡æ„
  
- [ ] 4.2 æœªæ¥è¿ç§»è¯„ä¼°
  - [ ] å®šæœŸè¯„ä¼°è·¯çº¿ 1 çš„å¯è¡Œæ€§
  - [ ] å½“æ¸¸æˆæ›´æ–°æˆ–æ¶æ„å˜åŒ–æ—¶ï¼Œé‡æ–°è€ƒè™‘ç»Ÿä¸€æ ¼å¼

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

| ç»´åº¦ | è·¯çº¿ 1: ç»Ÿä¸€æ ¼å¼ | è·¯çº¿ 2: ä¿æŒå…¼å®¹ |
|------|------------------|------------------|
| **å¼€å‘æ—¶é—´** | 4-6 å‘¨ | 2-3 å‘¨ |
| **å®æœºæµ‹è¯•æ—¶é—´** | 2-4 å‘¨ | 1 å‘¨ |
| **æ€»é¢„ä¼°æ—¶é—´** | 6-10 å‘¨ | 3-4 å‘¨ |
| **æŠ€æœ¯é£é™©** | é«˜ | ä½ |
| **é•¿æœŸç»´æŠ¤æˆæœ¬** | ä½ | ä¸­-é«˜ |
| **æ¶æ„æ¸…æ™°åº¦** | é«˜ | ä¸­ |
| **å‘åå…¼å®¹æ€§** | å¯èƒ½ç ´å | å®Œå…¨ä¿æŒ |
| **æ¸¸æˆæ¨¡ç»„æ›´æ–°å½±å“** | éœ€è¦åŒæ­¥æ›´æ–° | ç‹¬ç«‹æ¼”è¿› |

---

## ğŸ¯ æ¨èç­–ç•¥

### å¦‚æœæ—¶é—´å……è£• + è¿½æ±‚æ¶æ„å®Œç¾
â†’ é€‰æ‹© **è·¯çº¿ 1**
- é€‚åˆé•¿æœŸé¡¹ç›®
- é€‚åˆå›¢é˜Ÿåä½œ
- é€‚åˆå¼€æºé¡¹ç›®

### å¦‚æœå¿«é€Ÿäº¤ä»˜ + é™ä½é£é™©
â†’ é€‰æ‹© **è·¯çº¿ 2**
- é€‚åˆä¸ªäººé¡¹ç›®
- é€‚åˆå¿«é€Ÿè¿­ä»£
- é€‚åˆä¸ç¡®å®šçš„éœ€æ±‚

### æ··åˆç­–ç•¥
å¯ä»¥å…ˆèµ° **è·¯çº¿ 2** å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œç„¶åé€æ­¥å‘ **è·¯çº¿ 1** è¿ç§»ï¼š
1. å…ˆå®ç°å…¼å®¹æ€§å±‚ï¼ˆè·¯çº¿ 2ï¼‰
2. è®°å½•æ‰€æœ‰éœ€è¦ä¿®æ”¹çš„ç‚¹
3. åœ¨æ¸¸æˆæ›´æ–°æˆ–é‡å¤§ç‰ˆæœ¬æ—¶ï¼Œå®æ–½è·¯çº¿ 1 çš„ä¿®æ”¹

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶
- `python/isaac_bridge.py` - Python ç«¯æ¡¥æ¥å™¨
- `python/data_replay_system.py` - å›æ”¾ç³»ç»Ÿï¼ˆä½¿ç”¨ RawMessage æ ¼å¼ï¼‰
- `python/data_recorder.py` - å½•åˆ¶ç³»ç»Ÿï¼ˆä½¿ç”¨ payload æ ¼å¼ï¼‰
- `python/data_replay_examples.py` - ä½¿ç”¨ç¤ºä¾‹

### æµ‹è¯•æ–‡ä»¶
- `python/test_integration.py` - é›†æˆæµ‹è¯•ï¼ˆå½“å‰æ— æ³•è¿è¡Œï¼‰
- `python/test_replay_final.py` - å›æ”¾æµ‹è¯•

### æ–‡æ¡£
- `docs/DATA_PROTOCOL.md` - æ¶ˆæ¯åè®®æ–‡æ¡£
- `README.md` - é¡¹ç›®è¯´æ˜

---

## ğŸ”— ç›¸å…³ Issue

- Issue: test_integration.py æ— æ³•è¿è¡Œ
- Issue: å½•åˆ¶æ•°æ® payload/channels ä¸º None
- Issue: ä¸¤å¥—å½•åˆ¶ç³»ç»Ÿæ ¼å¼ä¸ç»Ÿä¸€

---

> æ–‡æ¡£æœ€åæ›´æ–°: 2026-01-11
> 
> ç»´æŠ¤è€…: SocketBridge Development Team
