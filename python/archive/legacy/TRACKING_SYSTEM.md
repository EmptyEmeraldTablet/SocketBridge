# å¯¹è±¡è·Ÿè¸ªä¸ç©ºé—´æ„ŸçŸ¥ç³»ç»Ÿæ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿä¸ºã€Šä»¥æ’’çš„ç»“åˆï¼šé‡ç”Ÿã€‹æ¸¸æˆæ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡è·Ÿè¸ªå’Œç©ºé—´æ„ŸçŸ¥æ¡†æ¶ï¼Œå°†å®æ—¶æµå¼æ•°æ®è½¬æ¢ä¸ºç¨³å®šçš„ã€å¯è¿½è¸ªçš„æŠ½è±¡æ¨¡å‹ï¼Œä¸ºAIæ™ºèƒ½ä½“æä¾›å¯é çš„æ¸¸æˆç©ºé—´æ„ŸçŸ¥èƒ½åŠ›ã€‚

### æ ¸å¿ƒä»·å€¼

- **å¯¹è±¡è·Ÿè¸ª** - è¯†åˆ«å¹¶è·Ÿè¸ªæ¸¸æˆä¸­çš„å®ä½“ï¼ˆæ•Œäººã€æŠ•å°„ç‰©ç­‰ï¼‰ï¼Œç»´æŠ¤å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ
- **å†å²è½¨è¿¹** - è®°å½•å¯¹è±¡çš„ä½ç½®å’Œè¡Œä¸ºå†å²ï¼Œæ”¯æŒè¡Œä¸ºæ¨¡å¼åˆ†æ
- **æŠ½è±¡ç©ºé—´** - å°†è¿ç»­çš„æ¸¸æˆç©ºé—´è½¬æ¢ä¸ºç¦»æ•£åŒ–çš„ç½‘æ ¼æ¨¡å‹
- **å¨èƒåˆ†æ** - å®æ—¶åˆ†æç©ºé—´ä¸­çš„å¨èƒåˆ†å¸ƒï¼Œä¸ºå†³ç­–æä¾›ä¾æ®
- **æ™ºèƒ½å†³ç­–** - åŸºäºå¨èƒåˆ†ææä¾›ç§»åŠ¨å’Œå°„å‡»å»ºè®®

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸¸æˆæ•°æ®æµ                                 â”‚
â”‚                                                               â”‚
â”‚  å®æ—¶æ•°æ® (æ¯å¸§)                                              â”‚
â”‚  â”œâ”€â”€ PLAYER_POSITION (ç©å®¶ä½ç½®)                               â”‚
â”‚  â”œâ”€â”€ ENEMIES (æ•Œäººåˆ—è¡¨)                                       â”‚
â”‚  â”œâ”€â”€ PROJECTILES (æŠ•å°„ç‰©åˆ—è¡¨)                                â”‚
â”‚  â”œâ”€â”€ ROOM_INFO (æˆ¿é—´ä¿¡æ¯)                                     â”‚
â”‚  â””â”€â”€ ROOM_LAYOUT (æˆ¿é—´å¸ƒå±€)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ObjectTracker (å¯¹è±¡è·Ÿè¸ªå™¨)                       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¯¹è±¡è¯†åˆ«ä¸è·Ÿè¸ª                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Enemy (æ•Œäººå¯¹è±¡)                                 â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ä½ç½®è·Ÿè¸ª                                     â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ é€Ÿåº¦è·Ÿè¸ª                                     â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ç”Ÿå‘½å‘¨æœŸç®¡ç†                                 â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ å†å²è½¨è¿¹ (60å¸§)                              â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€ è¡Œä¸ºæ¨¡å¼åˆ†æ                                 â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Projectile (æŠ•å°„ç‰©å¯¹è±¡)                          â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ ä½ç½®è·Ÿè¸ª                                     â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ é€Ÿåº¦è·Ÿè¸ª                                     â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ å¨èƒé¢„æµ‹                                     â”‚   â”‚
â”‚  â”‚      â””â”€â”€ å‡»ä¸­æ—¶é—´é¢„æµ‹                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  è¾“å‡º: ç¨³å®šçš„å¯¹è±¡åˆ—è¡¨ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«å®Œæ•´çš„å†å²å’ŒçŠ¶æ€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GameSpace (æ¸¸æˆç©ºé—´æ¨¡å‹)                         â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç©ºé—´ç½‘æ ¼åŒ–                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ç½‘æ ¼å•å…ƒ (GridCell)                             â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ç±»å‹ (ç©ºåœ°/éšœç¢ç‰©/é—¨/å±é™©)                   â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ å¨èƒç­‰çº§ [0, 1]                              â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ å¨èƒæºåˆ—è¡¨                                   â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€ è·ç¦»ä¿¡æ¯                                     â”‚   â”‚
â”‚  â”‚  â””â”€â”€ å¨èƒæº (ThreatSource)                            â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ ä½ç½®                                         â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ é€Ÿåº¦                                         â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ å¨èƒåŠå¾„                                     â”‚   â”‚
â”‚  â”‚      â””â”€â”€ å¨èƒå¼ºåº¦                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  è¾“å‡º: ç¦»æ•£åŒ–çš„ç©ºé—´æ¨¡å‹ï¼Œæ¯ä¸ªç½‘æ ¼å•å…ƒåŒ…å«å¨èƒä¿¡æ¯              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ThreatAnalyzer (å¨èƒåˆ†æå™¨)                        â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¨èƒåˆ†æ                                              â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ç©å®¶å¨èƒè¯„ä¼°                                     â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ å½“å‰å¨èƒç­‰çº§                                 â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ æœ€è¿‘æ•Œäººè·ç¦»                                 â”‚   â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ æœ€è¿‘æŠ•å°„ç‰©è·ç¦»                               â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€ å¨èƒå‘é‡è®¡ç®—                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ å¨èƒåˆ†ç±» (critical/high/medium/low)              â”‚   â”‚
â”‚  â”‚  â””â”€â”€ æ¨èè¡ŒåŠ¨                                          â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ ç§»åŠ¨æ–¹å‘                                     â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ å°„å‡»æ–¹å‘                                     â”‚   â”‚
â”‚  â”‚      â””â”€â”€ ç½®ä¿¡åº¦                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  è¾“å‡º: å¨èƒåˆ†æç»“æœå’Œæ¨èè¡ŒåŠ¨                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AIå†³ç­–å±‚                                         â”‚
â”‚                                                               â”‚
â”‚  åŸºäºå¨èƒåˆ†æç»“æœï¼Œåšå‡ºç§»åŠ¨å’Œå°„å‡»å†³ç­–                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. game_tracker.py - å¯¹è±¡è·Ÿè¸ªå™¨

#### 1.1 æ ¸å¿ƒç±»

**Position** - ä½ç½®ä¿¡æ¯
```python
@dataclass
class Position:
    x: float
    y: float
    
    def distance_to(self, other: Position) -> float
    def direction_to(self, other: Position) -> Tuple[float, float]
```

**Velocity** - é€Ÿåº¦ä¿¡æ¯
```python
@dataclass
class Velocity:
    x: float
    y: float
    
    @property
    def magnitude(self) -> float
    
    @property
    def direction(self) -> Tuple[float, float]
```

**TrackedObject** - è¢«è·Ÿè¸ªçš„å¯¹è±¡åŸºç±»
```python
@dataclass
class TrackedObject:
    id: int                      # å¯¹è±¡ID
    type: ObjectType             # å¯¹è±¡ç±»å‹
    pos: Position                # å½“å‰ä½ç½®
    vel: Velocity                # å½“å‰é€Ÿåº¦
    state: ObjectState           # å¯¹è±¡çŠ¶æ€
    
    # è·Ÿè¸ªä¿¡æ¯
    first_seen_frame: int        # é¦–æ¬¡å‡ºç°çš„å¸§
    last_seen_frame: int         # æœ€åå‡ºç°çš„å¸§
    frames_not_seen: int        # è¿ç»­æœªçœ‹åˆ°çš„å¸§æ•°
    
    # å†å²è½¨è¿¹ï¼ˆæœ€å¤šä¿å­˜æœ€è¿‘60å¸§ï¼‰
    position_history: deque     # ä½ç½®å†å²
    velocity_history: deque     # é€Ÿåº¦å†å²
    
    # è¡Œä¸ºåˆ†æ
    avg_velocity: Velocity       # å¹³å‡é€Ÿåº¦
    movement_pattern: str        # ç§»åŠ¨æ¨¡å¼
    
    def update(self, pos, vel, frame, **kwargs)
    def predict_position(self, frames_ahead: int) -> Position
    def get_lifetime_frames(self) -> int
    def is_alive(self) -> bool
```

**Enemy** - æ•Œäººå¯¹è±¡
```python
@dataclass
class Enemy(TrackedObject):
    state: int                   # æ¸¸æˆå†…çŠ¶æ€
    state_frame: int             # å½“å‰çŠ¶æ€æŒç»­å¸§æ•°
    projectile_cooldown: int     # æŠ•å°„ç‰©å†·å´
    projectile_delay: int        # æŠ•å°„ç‰©å‘å°„é—´éš”
    
    # è¡Œä¸ºåˆ†æ
    last_attack_frame: int       # æœ€åæ”»å‡»å¸§
    attack_pattern: List[int]    # æ”»å‡»é—´éš”å†å²
    
    def can_attack(self, current_frame: int) -> bool
    def record_attack(self, frame: int)
    def get_avg_attack_interval(self) -> float
```

**Projectile** - æŠ•å°„ç‰©å¯¹è±¡
```python
@dataclass
class Projectile(TrackedObject):
    variant: int
    collision_radius: float
    height: float
    is_enemy: bool
    
    def predict_impact_time(self, target_pos: Position) -> Optional[int]
```

**ObjectTracker** - å¯¹è±¡è·Ÿè¸ªå™¨æ ¸å¿ƒç±»
```python
class ObjectTracker:
    def __init__(self, max_missing_frames: int = 30)
    
    def update(self, frame: int, enemies_data: List[dict], 
               projectiles_data: dict)
    
    def get_active_enemies(self) -> List[Enemy]
    def get_enemy_by_id(self, enemy_id: int) -> Optional[Enemy]
    def get_nearest_enemy(self, pos: Position) -> Optional[Enemy]
    def get_enemy_projectiles(self) -> List[Projectile]
    def get_dangerous_projectiles(self, pos: Position, 
                                   max_distance: float = 200.0) -> List[Projectile]
    def get_stats(self) -> Dict[str, Any]
```

#### 1.2 å·¥ä½œåŸç†

**å¯¹è±¡è¯†åˆ«ä¸è·Ÿè¸ª**
1. æ¯å¸§æ¥æ”¶æ•Œäººå’ŒæŠ•å°„ç‰©æ•°æ®
2. æ ¹æ®å¯¹è±¡IDè¯†åˆ«æ–°å¯¹è±¡æˆ–æ›´æ–°ç°æœ‰å¯¹è±¡
3. è®°å½•ä½ç½®å’Œé€Ÿåº¦å†å²
4. åˆ†æç§»åŠ¨æ¨¡å¼ï¼ˆstationary/chasing/erraticï¼‰
5. æ£€æµ‹å¯¹è±¡æ­»äº¡ï¼ˆHP <= 0ï¼‰

**ç”Ÿå‘½å‘¨æœŸç®¡ç†**
1. å¯¹è±¡é¦–æ¬¡å‡ºç°æ—¶è®°å½• `first_seen_frame`
2. æ¯å¸§æ›´æ–° `last_seen_frame`
3. å¦‚æœå¯¹è±¡è¿ç»­ `max_missing_frames` å¸§æœªå‡ºç°ï¼Œæ ‡è®°ä¸ºæ¶ˆå¤±
4. ç»´æŠ¤å¯¹è±¡ä»å‡ºç°åˆ°æ¶ˆå¤±çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

**è¡Œä¸ºæ¨¡å¼åˆ†æ**
- **stationary** - é€Ÿåº¦æ–¹å·® < 0.5ï¼ˆå‡ ä¹ä¸åŠ¨ï¼‰
- **chasing** - é€Ÿåº¦æ–¹å·® 0.5-3.0ï¼ˆæ­£å¸¸ç§»åŠ¨ï¼‰
- **erratic** - é€Ÿåº¦æ–¹å·® > 3.0ï¼ˆå¿«é€Ÿå˜åŒ–ï¼‰

---

### 2. game_space.py - æ¸¸æˆç©ºé—´æ¨¡å‹

#### 2.1 æ ¸å¿ƒç±»

**GridCell** - ç½‘æ ¼å•å…ƒ
```python
@dataclass
class GridCell:
    x: int                      # ç½‘æ ¼Xåæ ‡
    y: int                      # ç½‘æ ¼Yåæ ‡
    cell_type: CellType         # å•å…ƒç±»å‹
    
    # å¨èƒä¿¡æ¯
    threat_level: float         # å¨èƒç­‰çº§ [0, 1]
    threat_sources: List[int]    # å¨èƒæºå¯¹è±¡IDåˆ—è¡¨
    
    # è·ç¦»ä¿¡æ¯
    distance_to_player: float
    distance_to_nearest_enemy: float
    
    # è·¯å¾„è§„åˆ’
    path_cost: float
    parent: Optional[Tuple[int, int]]
    
    def is_walkable(self) -> bool
    def is_safe(self, threshold: float = 0.3) -> bool
```

**ThreatSource** - å¨èƒæº
```python
@dataclass
class ThreatSource:
    obj_id: int
    position: Position
    velocity: Velocity
    threat_type: str            # "enemy", "projectile", "laser"
    threat_radius: float
    threat_intensity: float     # å¨èƒå¼ºåº¦ [0, 1]
    
    def get_threat_at(self, pos: Position) -> float
```

**GameSpace** - æ¸¸æˆç©ºé—´æ¨¡å‹
```python
class GameSpace:
    def __init__(self, grid_size: float = 40.0)
    
    def initialize_from_room(self, room_info: dict, room_layout: dict)
    def update(self, player_pos: Position, tracker: ObjectTracker)
    
    def get_cell(self, world_pos: Position) -> Optional[GridCell]
    def get_safe_cells(self, threshold: float = 0.3) -> List[GridCell]
    def get_safest_cell_nearby(self, world_pos: Position, 
                                max_distance: float = 200.0) -> Optional[GridCell]
    def find_path(self, start: Position, goal: Position, 
                   max_threat: float = 0.5) -> Optional[List[Position]]
    def get_threat_at(self, pos: Position) -> float
    def get_space_features(self) -> Dict[str, Any]
```

**ThreatAnalyzer** - å¨èƒåˆ†æå™¨
```python
class ThreatAnalyzer:
    def __init__(self, space: GameSpace, tracker: ObjectTracker)
    
    def analyze_player_threat(self, player_pos: Position) -> Dict[str, Any]
    def get_recommended_action(self, player_pos: Position) -> Dict[str, Any]
```

#### 2.2 å·¥ä½œåŸç†

**ç©ºé—´ç½‘æ ¼åŒ–**
1. æ ¹æ®æˆ¿é—´è¾¹ç•Œåˆ›å»ºç½‘æ ¼
2. æ ‡è®°éšœç¢ç‰©ã€é—¨ã€å±é™©åŒºåŸŸ
3. æ¯ä¸ªç½‘æ ¼å•å…ƒä¿å­˜å¨èƒç­‰çº§å’Œè·ç¦»ä¿¡æ¯

**å¨èƒåœºè®¡ç®—**
1. ä»è·Ÿè¸ªå™¨è·å–æ‰€æœ‰å¨èƒæºï¼ˆæ•Œäººã€æŠ•å°„ç‰©ï¼‰
2. ä¸ºæ¯ä¸ªå¨èƒæºè®¾ç½®å¨èƒåŠå¾„å’Œå¼ºåº¦
3. è®¡ç®—æ¯ä¸ªç½‘æ ¼å•å…ƒçš„å¨èƒå€¼ï¼ˆéšè·ç¦»è¡°å‡ï¼‰
4. ç´¯åŠ æ‰€æœ‰å¨èƒæºçš„å¨èƒå€¼

**å¨èƒç­‰çº§åˆ†ç±»**
- **critical** - å¨èƒ > 0.7 æˆ– æŠ•å°„ç‰©è·ç¦» < 50
- **high** - å¨èƒ > 0.4 æˆ– æ•Œäººè·ç¦» < 100
- **medium** - å¨èƒ > 0.2 æˆ– æ•Œäººè·ç¦» < 200
- **low** - å…¶ä»–æƒ…å†µ

**æ¨èè¡ŒåŠ¨**
- **evade** - ç´§æ€¥èº²é¿ï¼ˆcriticalå¨èƒï¼‰
- **cautious_move** - è°¨æ…ç§»åŠ¨ï¼ˆhighå¨èƒï¼‰
- **tactical_move** - æˆ˜æœ¯ç§»åŠ¨ï¼ˆmediumå¨èƒï¼‰
- **free_move** - è‡ªç”±ç§»åŠ¨ï¼ˆlowå¨èƒï¼‰

---

### 3. advanced_ai_example.py - é«˜çº§AIç¤ºä¾‹

#### 3.1 æ ¸å¿ƒç±»

**AdvancedAI** - é«˜çº§AIæ§åˆ¶å™¨
```python
class AdvancedAI:
    def __init__(self, bridge: IsaacBridge)
    
    def update(self) -> Tuple[Tuple[int, int], Tuple[int, int]]
    def get_tracked_objects_info(self) -> Dict[str, Any]
    def get_space_info(self) -> Dict[str, Any]
    def get_threat_info(self) -> Optional[Dict[str, Any]]
    def get_stats(self) -> Dict[str, Any]
```

#### 3.2 å·¥ä½œæµç¨‹

1. **æ•°æ®æ›´æ–°** - æ¯å¸§æ¥æ”¶æ¸¸æˆæ•°æ®ï¼Œæ›´æ–°è·Ÿè¸ªå™¨å’Œç©ºé—´æ¨¡å‹
2. **æˆ¿é—´å˜åŒ–** - æ£€æµ‹æˆ¿é—´å˜åŒ–ï¼Œåˆå§‹åŒ–æ–°çš„ç©ºé—´æ¨¡å‹
3. **å¨èƒåˆ†æ** - åˆ†æç©å®¶é¢ä¸´çš„å¨èƒ
4. **å†³ç­–åˆ¶å®š** - æ ¹æ®å¨èƒç­‰çº§åˆ¶å®šç§»åŠ¨å’Œå°„å‡»ç­–ç•¥
5. **æŒ‡ä»¤å‘é€** - å°†å†³ç­–è½¬æ¢ä¸ºæ¸¸æˆæŒ‡ä»¤å‘é€

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

#### 1. ä½¿ç”¨å¯¹è±¡è·Ÿè¸ªå™¨

```python
from isaac_bridge import IsaacBridge, GameDataAccessor
from game_tracker import ObjectTracker, Position

# åˆ›å»ºæ¡¥æ¥å’Œè·Ÿè¸ªå™¨
bridge = IsaacBridge()
tracker = ObjectTracker(max_missing_frames=30)

# å¯åŠ¨æ¡¥æ¥
bridge.start()

# åœ¨æ•°æ®å›è°ƒä¸­æ›´æ–°è·Ÿè¸ªå™¨
@bridge.on("data")
def on_data_update(data):
    frame = bridge.state.frame
    
    # è·å–æ•Œäººå’ŒæŠ•å°„ç‰©æ•°æ®
    enemies = bridge.data.get_enemies() or []
    projectiles = bridge.data.get_projectiles() or {}
    
    # æ›´æ–°è·Ÿè¸ªå™¨
    tracker.update(frame, enemies, projectiles)
    
    # è·å–æ´»è·ƒæ•Œäºº
    active_enemies = tracker.get_active_enemies()
    print(f"Active enemies: {len(active_enemies)}")
    
    # è·å–æœ€è¿‘çš„æ•Œäºº
    player_pos = Position(100, 200)
    nearest_enemy = tracker.get_nearest_enemy(player_pos)
    if nearest_enemy:
        print(f"Nearest enemy: ID={nearest_enemy.id}, "
              f"distance={nearest_enemy.pos.distance_to(player_pos):.1f}")
```

#### 2. ä½¿ç”¨ç©ºé—´æ¨¡å‹

```python
from game_space import GameSpace, ThreatAnalyzer

# åˆ›å»ºç©ºé—´æ¨¡å‹
space = GameSpace(grid_size=40.0)

# åˆå§‹åŒ–ç©ºé—´ï¼ˆåœ¨æˆ¿é—´å˜åŒ–æ—¶ï¼‰
room_info = bridge.data.get_room_info()
room_layout = bridge.data.get_room_layout()
if room_info and room_layout:
    space.initialize_from_room(room_info, room_layout)

# æ›´æ–°ç©ºé—´ï¼ˆæ¯å¸§ï¼‰
player_pos = Position(100, 200)
space.update(player_pos, tracker)

# è·å–å¨èƒç­‰çº§
threat_level = space.get_threat_at(player_pos)
print(f"Current threat level: {threat_level:.2f}")

# è·å–é™„è¿‘æœ€å®‰å…¨çš„ä½ç½®
safest_cell = space.get_safest_cell_nearby(player_pos, max_distance=200.0)
if safest_cell:
    safest_pos = space._grid_to_world(safest_cell.x, safest_cell.y)
    print(f"Safest position: ({safest_pos.x:.1f}, {safest_pos.y:.1f})")
```

#### 3. ä½¿ç”¨å¨èƒåˆ†æå™¨

```python
# åˆ›å»ºå¨èƒåˆ†æå™¨
analyzer = ThreatAnalyzer(space, tracker)

# åˆ†æç©å®¶å¨èƒ
threat_info = analyzer.analyze_player_threat(player_pos)
print(f"Threat level: {threat_info['threat_level']}")
print(f"Current threat: {threat_info['current_threat']:.2f}")
print(f"Nearest enemy distance: {threat_info['nearest_enemy_distance']:.1f}")

# è·å–æ¨èè¡ŒåŠ¨
recommendation = analyzer.get_recommended_action(player_pos)
print(f"Recommended action: {recommendation['action']}")
print(f"Move direction: {recommendation['move_dir']}")
print(f"Shoot direction: {recommendation['shoot_dir']}")
print(f"Confidence: {recommendation['confidence']:.2f}")
```

#### 4. ä½¿ç”¨é«˜çº§AI

```python
from advanced_ai_example import AdvancedAI

# åˆ›å»ºé«˜çº§AI
ai = AdvancedAI(bridge)

# ä¸»å¾ªç¯
while True:
    # è·å–AIå†³ç­–
    move_dir, shoot_dir = ai.update()
    
    # å‘é€æ§åˆ¶æŒ‡ä»¤
    if move_dir != (0, 0) or shoot_dir != (0, 0):
        bridge.send_input(move_dir=move_dir, shoot_dir=shoot_dir)
    
    # æ¯60å¸§è¾“å‡ºä¸€æ¬¡çŠ¶æ€
    if bridge.state.frame % 60 == 0:
        print(f"Frame {bridge.state.frame}")
        print(f"Enemies: {len(ai.tracker.get_active_enemies())}")
        print(f"Projectiles: {len(ai.tracker.get_enemy_projectiles())}")
        
        # è¾“å‡ºå¨èƒä¿¡æ¯
        threat_info = ai.get_threat_info()
        if threat_info:
            print(f"Threat: {threat_info['threat_level']}")
    
    time.sleep(0.016)  # ~60 FPS
```

---

## ğŸ§ª æµ‹è¯•å·¥å…·

### test_tracker.py - è·Ÿè¸ªå™¨æµ‹è¯•å·¥å…·

```bash
cd python
python test_tracker.py
```

**åŠŸèƒ½ï¼š**
- å®æ—¶æ˜¾ç¤ºè·Ÿè¸ªå™¨çŠ¶æ€
- æ˜¾ç¤ºæ´»è·ƒæ•Œäººè¯¦æƒ…
- æ˜¾ç¤ºç©ºé—´ç‰¹å¾å’Œå¨èƒåˆ†æ
- æ˜¾ç¤ºæ¨èè¡ŒåŠ¨
- å¯¼å‡ºè·Ÿè¸ªæ•°æ®åˆ°JSON

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
============================================================
å¸§æ•°: 1234
æˆ¿é—´: 42
============================================================

è·Ÿè¸ªå™¨ç»Ÿè®¡:
  æ€»æ•Œäººæ•°: 15
  æ´»è·ƒæ•Œäºº: 5
  å‡»æ€æ•Œäºº: 10
  æ€»æŠ•å°„ç‰©: 120
  æ´»è·ƒæŠ•å°„ç‰©: 8

æ´»è·ƒæ•Œäººè¯¦æƒ…:
  ID=12345, ç±»å‹=10, è¡€é‡=20.0/20.0, ä½ç½®=(300.0, 200.0), æ¨¡å¼=chasing
  ID=12346, ç±»å‹=10, è¡€é‡=15.0/20.0, ä½ç½®=(350.0, 250.0), æ¨¡å¼=erratic

ç©ºé—´ç‰¹å¾:
  å¹³å‡å¨èƒ: 0.234
  æœ€å¤§å¨èƒ: 0.678
  å®‰å…¨åŒºåŸŸæ¯”ä¾‹: 65.2%
  å¨èƒæºæ•°é‡: 13

ç©å®¶å¨èƒåˆ†æ:
  å½“å‰å¨èƒç­‰çº§: 0.345
  å¨èƒåˆ†ç±»: medium
  æœ€è¿‘æ•Œäººè·ç¦»: 150.0
  æœ€è¿‘æŠ•å°„ç‰©è·ç¦»: 80.0
  å±é™©æŠ•å°„ç‰©æ•°é‡: 3

æ¨èè¡ŒåŠ¨:
  è¡ŒåŠ¨ç±»å‹: tactical_move
  ç§»åŠ¨æ–¹å‘: (-0.71, 0.71)
  å°„å‡»æ–¹å‘: (0.82, -0.57)
  ç½®ä¿¡åº¦: 0.60
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### æ•Œäººå¯¹è±¡æ•°æ®ç»“æ„

```json
{
  "id": 12345,
  "type": 10,
  "variant": 0,
  "subtype": 0,
  "pos": {"x": 300.0, "y": 200.0},
  "vel": {"x": 0.5, "y": 0.0},
  "hp": 20.0,
  "max_hp": 20.0,
  "is_boss": false,
  "is_champion": false,
  "state": 3,
  "state_frame": 10,
  "projectile_cooldown": 30,
  "projectile_delay": 60,
  "collision_radius": 15.0,
  "distance": 250.0,
  "target_pos": {"x": 100.0, "y": 200.0},
  "v1": {"x": 0.0, "y": 0.0},
  "v2": {"x": 0.0, "y": 0.0}
}
```

### æŠ•å°„ç‰©å¯¹è±¡æ•°æ®ç»“æ„

```json
{
  "id": 67890,
  "pos": {"x": 250.0, "y": 180.0},
  "vel": {"x": -2.0, "y": 0.0},
  "variant": 0,
  "collision_radius": 8.0,
  "height": 0.0,
  "falling_speed": 0.0,
  "falling_accel": 0.0
}
```

### å¨èƒåˆ†æç»“æœæ•°æ®ç»“æ„

```json
{
  "current_threat": 0.345,
  "nearest_enemy_distance": 150.0,
  "nearest_projectile_distance": 80.0,
  "dangerous_projectiles_count": 3,
  "safest_position": [120.0, 180.0],
  "safest_threat": 0.123,
  "threat_vector": [0.71, -0.71],
  "threat_level": "medium"
}
```

### æ¨èè¡ŒåŠ¨æ•°æ®ç»“æ„

```json
{
  "action": "tactical_move",
  "move_dir": [-0.71, 0.71],
  "shoot_dir": [0.82, -0.57],
  "threat_level": "medium",
  "confidence": 0.60
}
```

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰å¨èƒæº

```python
from game_space import ThreatSource, Position, Velocity

# æ·»åŠ è‡ªå®šä¹‰å¨èƒæº
custom_threat = ThreatSource(
    obj_id=99999,
    position=Position(300, 200),
    velocity=Velocity(0, 0),
    threat_type="custom",
    threat_radius=150.0,
    threat_intensity=0.8
)

space.threat_sources.append(custom_threat)
space._compute_threat_field()
```

### 2. è·¯å¾„è§„åˆ’

```python
# ä½¿ç”¨A*ç®—æ³•å¯»æ‰¾è·¯å¾„
start_pos = Position(100, 200)
goal_pos = Position(400, 300)

path = space.find_path(start_pos, goal_pos, max_threat=0.5)

if path:
    print(f"Path found with {len(path)} steps")
    for i, pos in enumerate(path):
        print(f"  Step {i}: ({pos.x:.1f}, {pos.y:.1f})")
else:
    print("No path found")
```

### 3. è¡Œä¸ºæ¨¡å¼åˆ†æ

```python
# è·å–æ•Œäººçš„ç§»åŠ¨æ¨¡å¼
enemy = tracker.get_enemy_by_id(12345)
print(f"Movement pattern: {enemy.movement_pattern}")

# è·å–æ•Œäººçš„æ”»å‡»æ¨¡å¼
if hasattr(enemy, 'attack_pattern') and enemy.attack_pattern:
    avg_interval = enemy.get_avg_attack_interval()
    print(f"Average attack interval: {avg_interval:.1f} frames")
    print(f"Attack count: {len(enemy.attack_pattern)}")
```

### 4. å†å²è½¨è¿¹åˆ†æ

```python
# è·å–æ•Œäººçš„ä½ç½®å†å²
enemy = tracker.get_enemy_by_id(12345)
print(f"Position history (last 60 frames):")
for i, pos in enumerate(enemy.position_history):
    print(f"  Frame {i}: ({pos.x:.1f}, {pos.y:.1f})")

# é¢„æµ‹æœªæ¥ä½ç½®
future_pos = enemy.predict_position(frames_ahead=10)
print(f"Predicted position in 10 frames: ({future_pos.x:.1f}, {future_pos.y:.1f})")
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. è°ƒæ•´ç½‘æ ¼å¤§å°

```python
# è¾ƒå¤§çš„ç½‘æ ¼ = æ›´å¿«çš„è®¡ç®—ï¼Œä½†ç²¾åº¦è¾ƒä½
space = GameSpace(grid_size=60.0)

# è¾ƒå°çš„ç½‘æ ¼ = æ›´é«˜çš„ç²¾åº¦ï¼Œä½†è®¡ç®—æ›´æ…¢
space = GameSpace(grid_size=20.0)
```

### 2. è°ƒæ•´å†å²è½¨è¿¹é•¿åº¦

```python
from collections import deque

# å‡å°‘å†å²è½¨è¿¹é•¿åº¦ä»¥èŠ‚çœå†…å­˜
enemy.position_history = deque(maxlen=30)
enemy.velocity_history = deque(maxlen=30)
```

### 3. è°ƒæ•´å¨èƒåˆ†æé¢‘ç‡

```python
# ä¸éœ€è¦æ¯å¸§éƒ½è¿›è¡Œå¨èƒåˆ†æ
if frame % 3 == 0:  # æ¯3å¸§åˆ†æä¸€æ¬¡
    threat_info = analyzer.analyze_player_threat(player_pos)
```

---

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯¹è±¡è·Ÿè¸ªä¸å‡†ç¡®**
   - æ£€æŸ¥ `max_missing_frames` è®¾ç½®æ˜¯å¦åˆé€‚
   - ç¡®è®¤æ¸¸æˆæ•°æ®æ›´æ–°é¢‘ç‡æ˜¯å¦æ­£å¸¸

2. **å¨èƒåˆ†æä¸å‡†ç¡®**
   - è°ƒæ•´å¨èƒæºçš„å¨èƒåŠå¾„å’Œå¼ºåº¦
   - æ£€æŸ¥ç½‘æ ¼å¤§å°æ˜¯å¦åˆé€‚

3. **è·¯å¾„è§„åˆ’å¤±è´¥**
   - æ£€æŸ¥ `max_threat` å‚æ•°æ˜¯å¦è¿‡é«˜
   - ç¡®è®¤èµ·ç‚¹å’Œç»ˆç‚¹æ˜¯å¦åœ¨å¯é€šè¡ŒåŒºåŸŸ

---

## ğŸ“ å¼€å‘è·¯çº¿å›¾

### å·²å®Œæˆ âœ…

- âœ… å¯¹è±¡è·Ÿè¸ªç³»ç»Ÿ
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… å†å²è½¨è¿¹è®°å½•
- âœ… è¡Œä¸ºæ¨¡å¼åˆ†æ
- âœ… ç©ºé—´ç½‘æ ¼åŒ–
- âœ… å¨èƒåœºè®¡ç®—
- âœ… å¨èƒåˆ†æå™¨
- âœ… è·¯å¾„è§„åˆ’ï¼ˆA*ç®—æ³•ï¼‰
- âœ… é«˜çº§AIç¤ºä¾‹
- âœ… æµ‹è¯•å·¥å…·

### è®¡åˆ’ä¸­ ğŸš§

- [ ] å¯è§†åŒ–å·¥å…·ï¼ˆå®æ—¶æ˜¾ç¤ºç©ºé—´å’Œå¨èƒï¼‰
- [ ] æ›´å¤šè¡Œä¸ºæ¨¡å¼è¯†åˆ«
- [ ] å¼ºåŒ–å­¦ä¹ é›†æˆ
- [ ] å¤šç©å®¶æ”¯æŒ
- [ ] æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

---

**æœ€åæ›´æ–°ï¼š** 2026å¹´1æœˆ7æ—¥
**ç‰ˆæœ¬ï¼š** 1.0
