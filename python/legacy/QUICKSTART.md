# å¯¹è±¡è·Ÿè¸ªç³»ç»Ÿ - å¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

è¿™ä¸ªç³»ç»Ÿå°†ã€Šä»¥æ’’çš„ç»“åˆï¼šé‡ç”Ÿã€‹çš„å®æ—¶æ¸¸æˆæ•°æ®è½¬æ¢ä¸ºç¨³å®šçš„ã€å¯è¿½è¸ªçš„æŠ½è±¡æ¨¡å‹ï¼Œä¸ºAIæ™ºèƒ½ä½“æä¾›å¯é çš„æ¸¸æˆçŠ¶æ€æ„ŸçŸ¥èƒ½åŠ›ã€‚

### æ ¸å¿ƒé—®é¢˜è§£å†³

**é—®é¢˜ï¼š** æ¸¸æˆæ¯å¸§éƒ½åœ¨å˜åŒ–ï¼Œæ•Œäººä½ç½®ã€æŠ•å°„ç‰©ä½ç½®éƒ½åœ¨å®æ—¶æ›´æ–°ï¼Œå¦‚ä½•ä»è¿™äº›æµå¼æ•°æ®ä¸­æ„å»ºå‡ºç¨³å®šçš„å¯¹è±¡æ¨¡å‹ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼š**
1. **å¯¹è±¡è·Ÿè¸ª** - é€šè¿‡ entity.Index è¯†åˆ«å’Œè·Ÿè¸ªæ¯ä¸ªå¯¹è±¡ï¼Œç»´æŠ¤å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ
2. **å†å²è½¨è¿¹** - è®°å½•å¯¹è±¡çš„ä½ç½®å’Œè¡Œä¸ºå†å²ï¼Œæ”¯æŒè¡Œä¸ºæ¨¡å¼åˆ†æ
3. **å”¯ä¸€æ ‡è¯†** - ä½¿ç”¨ entity.Index ç¡®ä¿åŒä¸€æˆ¿é—´å†…åŒç±»å‹æ•Œäººå¯ä»¥è¢«æ­£ç¡®åŒºåˆ†

---

## ğŸ“¦ æ–‡ä»¶ç»“æ„

```
python/
â”œâ”€â”€ game_tracker.py          # å¯¹è±¡è·Ÿè¸ªå™¨ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ test_tracker.py          # æµ‹è¯•å·¥å…·
â”œâ”€â”€ TRACKING_SYSTEM_SIMPLE.md # å®Œæ•´æ–‡æ¡£
â””â”€â”€ QUICKSTART.md            # æœ¬æ–‡ä»¶
```

---

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šæµ‹è¯•å¯¹è±¡è·Ÿè¸ªå™¨

```bash
cd python
python test_tracker.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
============================================================
å¸§æ•°: 1234
============================================================

è·Ÿè¸ªå™¨ç»Ÿè®¡:
  æ€»æ•Œäººæ•°: 15
  æ´»è·ƒæ•Œäºº: 5
  å‡»æ€æ•Œäºº: 10
  æ€»æŠ•å°„ç‰©: 120
  æ´»è·ƒæŠ•å°„ç‰©: 8

æ´»è·ƒæ•Œäººè¯¦æƒ…:
  ID=12345, ç±»å‹=10, è¡€é‡=20.0/20.0, ä½ç½®=(300.0, 200.0), æ¨¡å¼=chasing
  ID=12346, ç±»å‹=10, è¡€é‡=15.0/20.0, ä½ç½®=(350.0, 250.0), æ¨¡å¼=erratic
```

### æ­¥éª¤2ï¼šè¿è¡Œç¤ºä¾‹AI

```bash
python example_ai.py
```

è¿™ä¼šå¯åŠ¨ä¸€ä¸ªç®€å•çš„AIç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ï¼š
1. æ¥æ”¶æ¸¸æˆæ•°æ®
2. æ›´æ–°å¯¹è±¡è·Ÿè¸ªå™¨
3. åŸºäºè·Ÿè¸ªæ•°æ®åšå‡ºå†³ç­–

### æ­¥éª¤3ï¼šé›†æˆåˆ°ä½ çš„é¡¹ç›®

```python
from isaac_bridge import IsaacBridge
from game_tracker import ObjectTracker, Position

# åˆ›å»ºæ¡¥æ¥å’Œè·Ÿè¸ªå™¨
bridge = IsaacBridge()
tracker = ObjectTracker()

# å¯åŠ¨
bridge.start()

# åœ¨å›è°ƒä¸­æ›´æ–°è·Ÿè¸ªå™¨
@bridge.on("data")
def handle_data(data):
    frame = bridge.state.frame
    enemies = bridge.data.get_enemies() or []
    projectiles = bridge.data.get_projectiles() or {}
    
    tracker.update(frame, enemies, projectiles)
    
    # ä½¿ç”¨è·Ÿè¸ªæ•°æ®
    active_enemies = tracker.get_active_enemies()
    print(f"Found {len(active_enemies)} enemies")
```

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### entity.Index - å”¯ä¸€æ ‡è¯†ç¬¦

æ¸¸æˆä¸­æ¯ä¸ªå®ä½“éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ `entity.Index`ï¼Œåœ¨å½“å‰æˆ¿é—´å†…ä¸ä¼šé‡å¤ã€‚

```python
# ä»æ¸¸æˆæ•°æ®è·å–
enemy_data = {
    "id": entity.Index,  # å”¯ä¸€æ ‡è¯†ç¬¦
    "type": entity.Type,  # å®ä½“ç±»å‹ï¼ˆ10=æ•Œäººï¼‰
    "pos": {"x": 100, "y": 200},
    ...
}
```

**é‡è¦ï¼š** `entity.Index` ä¸åŒäº `entity.Type`ï¼š
- `entity.Type` - å®ä½“ç±»å‹ï¼ˆå¦‚ 10 = æ•Œäººï¼‰ï¼Œæ‰€æœ‰è‹è‡éƒ½æ˜¯ Type=10
- `entity.Index` - æˆ¿é—´å†…å”¯ä¸€ç´¢å¼•ï¼Œæ¯ä¸ªæ•Œäººå®ä¾‹éƒ½æœ‰ä¸åŒçš„ Index

### åŒç±»å‹å¤šæ•Œäººæ”¯æŒ

ç”±äºä½¿ç”¨ entity.Indexï¼Œè·Ÿè¸ªå™¨å¯ä»¥æ­£ç¡®å¤„ç†å¤šä¸ªåŒç±»å‹æ•Œäººï¼š

```python
# å‡è®¾æˆ¿é—´é‡Œæœ‰5åªè‹è‡
enemies = [
    {"id": 0, "type": 10, "pos": (100, 100)},  # ç¬¬ä¸€åªè‹è‡
    {"id": 1, "type": 10, "pos": (200, 200)},  # ç¬¬äºŒåªè‹è‡
    {"id": 2, "type": 10, "pos": (300, 300)},  # ç¬¬ä¸‰åªè‹è‡
    ...
]

tracker.update(frame, enemies, {})

# è·å–æ‰€æœ‰æ´»è·ƒæ•Œäºº
active = tracker.get_active_enemies()  # è¿”å›5ä¸ªç‹¬ç«‹çš„Enemyå¯¹è±¡
```

### ç”Ÿå‘½å‘¨æœŸç®¡ç†

è·Ÿè¸ªå™¨è‡ªåŠ¨ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼š

```python
# å¯¹è±¡é¦–æ¬¡å‡ºç°
enemy = tracker.get_enemy_by_id(new_id)
# first_seen_frame = å½“å‰å¸§

# å¯¹è±¡è¢«å‡»æ€ (HP <= 0)
# state å˜ä¸º DEAD
# enemies_killed è®¡æ•° +1

# å¯¹è±¡æ¶ˆå¤± (è¿ç»­30å¸§æœªå‡ºç°)
# state å˜ä¸º ESCAPED
# å¯¹è±¡ä»è·Ÿè¸ªå™¨ä¸­ç§»é™¤
```

---

## ğŸ“– å¸¸ç”¨API

### ObjectTracker

| æ–¹æ³• | æè¿° |
|------|------|
| `update(frame, enemies, projectiles)` | æ›´æ–°æ‰€æœ‰è·Ÿè¸ªå¯¹è±¡ |
| `get_active_enemies()` | è·å–æ‰€æœ‰å­˜æ´»æ•Œäºº |
| `get_enemy_by_id(id)` | æ ¹æ®IDè·å–æ•Œäºº |
| `get_nearest_enemy(pos)` | è·å–æœ€è¿‘çš„æ•Œäºº |
| `get_enemy_projectiles()` | è·å–æ‰€æœ‰æ•ŒäººæŠ•å°„ç‰© |
| `get_dangerous_projectiles(pos, max_distance)` | è·å–å±é™©æŠ•å°„ç‰© |
| `get_stats()` | è·å–ç»Ÿè®¡ä¿¡æ¯ |

### Enemy/Projectile

| å±æ€§ | æè¿° |
|------|------|
| `id` | entity.Index |
| `pos` | å½“å‰ä½ç½® (Position) |
| `vel` | å½“å‰é€Ÿåº¦ (Velocity) |
| `hp` / `max_hp` | ç”Ÿå‘½å€¼ |
| `movement_pattern` | ç§»åŠ¨æ¨¡å¼ |
| `position_history` | ä½ç½®å†å² (deque) |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å…³äºæˆ¿é—´åˆ‡æ¢

- è¿›å…¥æ–°æˆ¿é—´åï¼Œentity.Index ä¼šé‡æ–°ä» 0 å¼€å§‹
- å»ºè®®åœ¨ `ROOM_ENTER` äº‹ä»¶æ—¶é‡ç½®è·Ÿè¸ªå™¨

### å…³äºéçº¿æ€§è¿åŠ¨æ•Œäºº

å¯¹äºä¼ é€ã€é’»åœ°ç­‰æ•Œäººï¼š
- ç§»åŠ¨æ¨¡å¼åˆ†æä¼šè¾“å‡º "erratic"
- è½¨è¿¹é¢„æµ‹å¯èƒ½ä¸å‡†ç¡®
- ä»å¯è·å–æœ€åå·²çŸ¥ä½ç½®

### å…³äºæ¯ä½“æ•Œäºº

æ¯ä½“ç”Ÿæˆçš„å­æ•Œäººä¼šè·å¾—æ–°çš„ Indexï¼Œè·Ÿè¸ªå™¨ä¼šæ­£ç¡®å¤„ç†ã€‚

---

**æ›´å¤šä¿¡æ¯ï¼š** å‚è§ `TRACKING_SYSTEM_SIMPLE.md`
